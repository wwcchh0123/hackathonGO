# æ¡Œé¢åº”ç”¨æ‰“åŒ…æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•å°† Claude Code Desktop æ‰“åŒ…ä¸ºå„å¹³å°çš„å®‰è£…åŒ…ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

### æ‰€æœ‰å¹³å°

- Node.js >= 16
- npm æˆ– pnpm
- å·²å®‰è£…é¡¹ç›®ä¾èµ– (`npm install`)

### macOS æ‰“åŒ…

- macOS æ“ä½œç³»ç»Ÿï¼ˆæ¨è macOS 10.13 æˆ–æ›´é«˜ï¼‰
- Xcode Command Line Tools

### Windows æ‰“åŒ…

- Windows 10 æˆ–æ›´é«˜ç‰ˆæœ¬
- æˆ–åœ¨ macOS/Linux ä¸Šä½¿ç”¨ Wine è¿›è¡Œäº¤å‰ç¼–è¯‘

### Linux æ‰“åŒ…

- Linux æ“ä½œç³»ç»Ÿ
- æˆ–åœ¨ macOS/Windows ä¸Šä½¿ç”¨ Docker è¿›è¡Œäº¤å‰ç¼–è¯‘

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. ç”Ÿæˆå›¾æ ‡ï¼ˆé¦–æ¬¡æ‰“åŒ…æ—¶éœ€è¦ï¼‰

```bash
# ç”Ÿæˆæ‰€æœ‰å¹³å°å›¾æ ‡
npm run icons:all
```

### 3. æ‰“åŒ…åº”ç”¨

```bash
# æ‰“åŒ…å½“å‰å¹³å°çš„åº”ç”¨
npm run dist

# æˆ–è€…æŒ‡å®šå¹³å°
npm run dist:mac      # macOS
npm run dist:win      # Windows
npm run dist:linux    # Linux
```

## ğŸ“¦ æ‰“åŒ…å‘½ä»¤è¯¦è§£

### `npm run pack`

**ç”¨é€”**: å¿«é€Ÿæ‰“åŒ…æµ‹è¯•ï¼ˆä¸åˆ›å»ºå®‰è£…åŒ…ï¼‰

- ä»…æ‰“åŒ…åº”ç”¨æ–‡ä»¶ï¼Œä¸ç”Ÿæˆå®‰è£…ç¨‹åº
- è¾“å‡ºç›®å½•: `release/[platform]-unpacked/`
- é€‚åˆå¿«é€Ÿæµ‹è¯•æ‰“åŒ…ç»“æœ

```bash
npm run pack
```

### `npm run dist`

**ç”¨é€”**: ç”Ÿæˆå®Œæ•´çš„å®‰è£…åŒ…ï¼ˆå½“å‰å¹³å°ï¼‰

- è‡ªåŠ¨æ„å»º Web èµ„æº
- ç”Ÿæˆå¯¹åº”å¹³å°çš„å®‰è£…åŒ…
- è¾“å‡ºç›®å½•: `release/`

```bash
npm run dist
```

### å¹³å°ç‰¹å®šæ‰“åŒ…å‘½ä»¤

```bash
# macOS æ‰“åŒ…ï¼ˆç”Ÿæˆ .dmg å’Œ .zipï¼‰
npm run dist:mac

# Windows æ‰“åŒ…ï¼ˆç”Ÿæˆ .exe å®‰è£…ç¨‹åºå’Œ .zipï¼‰
npm run dist:win

# Linux æ‰“åŒ…ï¼ˆç”Ÿæˆ .AppImage, .deb, .rpmï¼‰
npm run dist:linux
```

## ğŸ“‚ è¾“å‡ºæ–‡ä»¶è¯´æ˜

æ‰“åŒ…å®Œæˆåï¼Œæ‰€æœ‰è¾“å‡ºæ–‡ä»¶ä½äº `release/` ç›®å½•ï¼š

### macOS

```
release/
â”œâ”€â”€ Agent for Desktop-0.1.0-arm64.dmg    # Apple Silicon å®‰è£…é•œåƒ
â”œâ”€â”€ Agent for Desktop-0.1.0-x64.dmg     # Intel èŠ¯ç‰‡å®‰è£…é•œåƒ
â”œâ”€â”€ Agent for Desktop-0.1.0-arm64-mac.zip
â””â”€â”€ Agent for Desktop-0.1.0-x64-mac.zip
```

### Windows

```
release/
â”œâ”€â”€ Agent for Desktop Setup 0.1.0.exe   # NSIS å®‰è£…ç¨‹åº
â””â”€â”€ Agent for Desktop-0.1.0-win.zip     # ä¾¿æºç‰ˆ
```

### Linux

```
release/
â”œâ”€â”€ Agent-for-Desktop-0.1.0.AppImage   # é€šç”¨æ ¼å¼
â”œâ”€â”€ agent-for-desktop_0.1.0_amd64.deb  # Debian/Ubuntu
â””â”€â”€ agent-for-desktop-0.1.0.x86_64.rpm # RedHat/Fedora
```

## âš™ï¸ æ‰“åŒ…é…ç½®

æ‰“åŒ…é…ç½®ä½äº `package.json` çš„ `build` å­—æ®µï¼š

```json
{
  "build": {
    "appId": "com.qiniu.claude-code-desktop",
    "productName": "Agent for Desktop",
    "directories": {
      "output": "release"
    }
  }
}
```

### å…³é”®é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `appId` | åº”ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆmacOS Bundle ID, Windows App User Model IDï¼‰ |
| `productName` | åº”ç”¨æ˜¾ç¤ºåç§° |
| `directories.output` | æ‰“åŒ…è¾“å‡ºç›®å½• |
| `files` | éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶åˆ—è¡¨ |
| `mac.category` | macOS åº”ç”¨åˆ†ç±» |
| `mac.target` | macOS æ‰“åŒ…æ ¼å¼ï¼ˆdmg, zipï¼‰ |
| `win.target` | Windows æ‰“åŒ…æ ¼å¼ï¼ˆnsis, zipï¼‰ |
| `linux.target` | Linux æ‰“åŒ…æ ¼å¼ï¼ˆAppImage, deb, rpmï¼‰ |

## ğŸ¨ å›¾æ ‡ç®¡ç†

### å›¾æ ‡æ–‡ä»¶ä½ç½®

```
assets/icons/
â”œâ”€â”€ icon.svg          # æºå›¾æ ‡ï¼ˆSVG æ ¼å¼ï¼‰
â”œâ”€â”€ icon.png          # é€šç”¨å›¾æ ‡ï¼ˆ512x512ï¼‰
â”œâ”€â”€ icon-16.png       # å„ç§å°ºå¯¸çš„ PNG
â”œâ”€â”€ icon-32.png
â”œâ”€â”€ icon-48.png
â”œâ”€â”€ icon-128.png
â”œâ”€â”€ icon-256.png
â”œâ”€â”€ icon-512.png
â”œâ”€â”€ icon.icns         # macOS å›¾æ ‡
â””â”€â”€ icon.ico          # Windows å›¾æ ‡
```

### ç”Ÿæˆå›¾æ ‡

```bash
# ä» SVG ç”Ÿæˆå„ç§å°ºå¯¸çš„ PNG
npm run icons

# ç”Ÿæˆå¹³å°ç‰¹å®šå›¾æ ‡ï¼ˆ.icns, .icoï¼‰
npm run icons:platform

# ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰å›¾æ ‡
npm run icons:all
```

### è‡ªå®šä¹‰å›¾æ ‡

1. æ›¿æ¢ `assets/icons/icon.svg` ä¸ºä½ çš„å›¾æ ‡æ–‡ä»¶
2. è¿è¡Œ `npm run icons:all` é‡æ–°ç”Ÿæˆæ‰€æœ‰å›¾æ ‡

**å›¾æ ‡è¦æ±‚**:
- SVG æ ¼å¼ï¼Œæ­£æ–¹å½¢ï¼ˆ1:1 æ¯”ä¾‹ï¼‰
- å»ºè®®å°ºå¯¸: 512x512 æˆ–æ›´å¤§
- ç®€æ´è®¾è®¡ï¼Œåœ¨å°å°ºå¯¸ä¸‹æ¸…æ™°å¯è§

## ğŸ” ä»£ç ç­¾åï¼ˆå¯é€‰ï¼‰

### macOS ä»£ç ç­¾å

1. åŠ å…¥ Apple Developer Program
2. åˆ›å»ºå¼€å‘è€…è¯ä¹¦
3. é…ç½®ç¯å¢ƒå˜é‡:

```bash
export CSC_LINK="path/to/certificate.p12"
export CSC_KEY_PASSWORD="certificate_password"
```

4. æ‰“åŒ…æ—¶è‡ªåŠ¨ç­¾å:

```bash
npm run dist:mac
```

### Windows ä»£ç ç­¾å

1. è·å–ä»£ç ç­¾åè¯ä¹¦ï¼ˆä» CA è´­ä¹°ï¼‰
2. é…ç½®ç¯å¢ƒå˜é‡:

```bash
export WIN_CSC_LINK="path/to/certificate.pfx"
export WIN_CSC_KEY_PASSWORD="certificate_password"
```

3. æ‰“åŒ…æ—¶è‡ªåŠ¨ç­¾å:

```bash
npm run dist:win
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. å›¾æ ‡æœªæ­£ç¡®æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°ç”Ÿæˆæ‰€æœ‰å›¾æ ‡
npm run icons:all

# æ¸…é™¤ç¼“å­˜åé‡æ–°æ‰“åŒ…
rm -rf release dist
npm run dist
```

### 2. macOS æç¤º"åº”ç”¨å·²æŸå"

**åŸå› **: åº”ç”¨æœªç­¾å

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä¸´æ—¶è§£å†³ï¼ˆå¼€å‘æµ‹è¯•ï¼‰
xattr -cr "/Applications/Agent for Desktop.app"

# æ°¸ä¹…è§£å†³ï¼šé…ç½®ä»£ç ç­¾å
```

### 3. Windows Defender æŠ¥æ¯’

**åŸå› **: åº”ç”¨æœªç­¾åï¼ŒWindows å¯¹æœªç­¾ååº”ç”¨ä¼šè­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**:
- å¼€å‘æµ‹è¯•ï¼šæ·»åŠ åˆ° Windows Defender ç™½åå•
- æ­£å¼å‘å¸ƒï¼šè´­ä¹°ä»£ç ç­¾åè¯ä¹¦å¹¶ç­¾å

### 4. Linux æ‰“åŒ…å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å®‰è£…å¿…è¦çš„ä¾èµ–
sudo apt-get install fakeroot dpkg rpm
```

### 5. æ‰“åŒ…æ–‡ä»¶è¿‡å¤§

**æ£€æŸ¥åŸå› **:
```bash
# æŸ¥çœ‹æ‰“åŒ…æ–‡ä»¶åˆ—è¡¨
npm run pack
```

**ä¼˜åŒ–å»ºè®®**:
- æ£€æŸ¥ `package.json` ä¸­çš„ `files` é…ç½®
- ç¡®ä¿ `node_modules` åªåŒ…å«ç”Ÿäº§ä¾èµ–
- ç§»é™¤ä¸å¿…è¦çš„èµ„æºæ–‡ä»¶

## ğŸ“ å®Œæ•´æ‰“åŒ…æµç¨‹ç¤ºä¾‹

```bash
# 1. ç¡®ä¿ä¾èµ–å·²å®‰è£…
npm install

# 2. ç”Ÿæˆæ‰€æœ‰å›¾æ ‡ï¼ˆé¦–æ¬¡æ‰“åŒ…ï¼‰
npm run icons:all

# 3. è¿è¡Œæµ‹è¯•
npm run test

# 4. æ„å»º Web èµ„æº
npm run build

# 5. æ‰“åŒ…åº”ç”¨
npm run dist:mac  # æ ¹æ®ä½ çš„å¹³å°é€‰æ‹©

# 6. æµ‹è¯•æ‰“åŒ…ç»“æœ
open release/  # æ‰“å¼€è¾“å‡ºç›®å½•
```

## ğŸš¢ å‘å¸ƒæµç¨‹

### 1. æ›´æ–°ç‰ˆæœ¬å·

```bash
# ç¼–è¾‘ package.json ä¸­çš„ version å­—æ®µ
# ä¾‹å¦‚: "version": "0.2.0"
```

### 2. æ‰“åŒ…æ‰€æœ‰å¹³å°ï¼ˆå¦‚æœå¯ç”¨ï¼‰

```bash
npm run dist:mac
npm run dist:win
npm run dist:linux
```

### 3. æµ‹è¯•å®‰è£…åŒ…

åœ¨å„ä¸ªå¹³å°ä¸Šæµ‹è¯•å®‰è£…åŒ…æ˜¯å¦æ­£å¸¸å·¥ä½œ

### 4. åˆ›å»º GitHub Release

```bash
git tag v0.2.0
git push origin v0.2.0
```

ä¸Šä¼ æ‰“åŒ…æ–‡ä»¶åˆ° GitHub Release

### 5. ç¼–å†™å‘å¸ƒè¯´æ˜

åŒ…æ‹¬ï¼š
- æ–°åŠŸèƒ½
- ä¿®å¤çš„é—®é¢˜
- å·²çŸ¥é—®é¢˜
- å‡çº§æ³¨æ„äº‹é¡¹

## ğŸ“š æ›´å¤šèµ„æº

- [electron-builder å®˜æ–¹æ–‡æ¡£](https://www.electron.build/)
- [Electron æ‰“åŒ…æŒ‡å—](https://www.electronjs.org/docs/latest/tutorial/application-distribution)
- [ä»£ç ç­¾åæŒ‡å—](https://www.electron.build/code-signing)

## ğŸ’¡ æç¤º

- é¦–æ¬¡æ‰“åŒ…å¯èƒ½éœ€è¦ä¸‹è½½ä¾èµ–ï¼Œæ—¶é—´è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…
- æ‰“åŒ…å‰ç¡®ä¿è¿è¡Œ `npm run build` æ„å»ºæœ€æ–°çš„ Web èµ„æº
- ä½¿ç”¨ `npm run pack` å¿«é€Ÿæµ‹è¯•ï¼Œé¿å…æ¯æ¬¡éƒ½ç”Ÿæˆå®Œæ•´å®‰è£…åŒ…
- å‘å¸ƒå‰åŠ¡å¿…åœ¨ç›®æ ‡å¹³å°ä¸Šæµ‹è¯•å®‰è£…åŒ…
- macOS å’Œ Windows åº”ç”¨å»ºè®®è¿›è¡Œä»£ç ç­¾åï¼Œæå‡ç”¨æˆ·ä¿¡ä»»åº¦
